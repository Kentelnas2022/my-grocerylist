<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Product</title>
    <link rel="stylesheet" href="/kentz/styles/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header>
        <h1 id="header-title">Edit Product</h1>
        <button class="menu-btn" onclick="toggleMenu()">☰</button>
        <nav id="nav-menu">
            <ul>
                <li><a href="index.html" onclick="closeMenu()">Dashboard</a></li>
                <li><a href="add-product.html">Add Product</a></li>
                <li><a href="settings.html">Settings</a></li>
                <li><a href="add-to-cart.html">My Cart</a></li>
                <li><a href="reglog.html" onclick="closeMenu()">Logout</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <form id="edit-product-form">
            <input type="text" id="product-name" placeholder="Product Name" required>
            <input type="text" id="brand" placeholder="Brand" required>
            <input type="number" id="price" placeholder="Price (₱)" required>
            <select id="weight" required>
                <option value="" disabled>Select Weight/Volume</option>
                <option value="1L">1L</option>
                <option value="30g">30g</option>
                <option value="175g">175g</option>
                <option value="250g">250g</option>
                <option value="500g">500g</option>
                <!-- Add more options as needed -->
            </select>
            <input type="number" id="quantity" placeholder="Quantity" required>
            <input type="text" id="store" placeholder="Store" required>
            <select id="category" name="category" required>
                <option value="Fruits">Fruits</option>
                <option value="Vegetables">Vegetables</option>
                <option value="Canned Goods">Canned Goods</option>
                <option value="Crackers">Crackers</option>
            </select>
            <input type="file" id="image" accept="image/*">
            <button type="submit">Update Product</button>
        </form>
        <div id="notification" class="hidden">Product updated successfully!</div>
    </main>

    <script src="/kentz/script/script.js"></script>
    <script>
        // Kini nga function modagan inig load sa page
        window.onload = function() {
            // Pagkuha sa URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const index = urlParams.get('index');
            
            // Kung naa'y index nga value, load ang product
            if (index !== null) {
                loadProduct(index);
            }

            // Event listener para sa form submit
            document.getElementById('edit-product-form').addEventListener('submit', function(event) {
                event.preventDefault(); // Paglikay sa default nga form submission
                
                // Kung naa'y index nga value, update ang product
                if (index !== null) {
                    updateProduct(index);
                }
            });
        };

        // Function para pag-load sa product gikan sa local storage base sa index
        function loadProduct(index) {
            const products = JSON.parse(localStorage.getItem('products')) || [];
            const product = products[index];
            
            // Pag-set sa mga value sa form fields
            if (product) {
                document.getElementById('product-name').value = product.name;
                document.getElementById('brand').value = product.brand;
                document.getElementById('price').value = product.price;
                document.getElementById('weight').value = product.weight;
                document.getElementById('quantity').value = product.quantity;
                document.getElementById('store').value = product.store;
                document.getElementById('category').value = product.category;
            }
        }

        // Function para pag-update sa product
        function updateProduct(index) {
            const productName = document.getElementById('product-name').value;
            const brand = document.getElementById('brand').value;
            const price = parseFloat(document.getElementById('price').value);
            const weight = document.getElementById('weight').value;
            const quantity = parseInt(document.getElementById('quantity').value);
            const store = document.getElementById('store').value;
            const image = document.getElementById('image').files[0];
            const category = document.getElementById('category').value;
            
            // Pagbasa sa image file kung naa
            const reader = new FileReader();
            reader.onloadend = function() {
                // Paghimo og updated product object
                const updatedProduct = {
                    name: productName,
                    brand: brand,
                    price: price,
                    weight: weight,
                    quantity: quantity,
                    store: store,
                    image: reader.result,
                    category: category
                };
                
                // Pagkuha sa existing products gikan sa local storage
                let products = JSON.parse(localStorage.getItem('products')) || [];
                products[index] = updatedProduct; // Pag-update sa product sa specified nga index
                localStorage.setItem('products', JSON.stringify(products));
                showNotification('Product updated successfully!');
                window.location.href = 'settings.html'; // Redirect sa settings page
            };

            // Kung naa'y image file, convert sa base64 string
            if (image) {
                reader.readAsDataURL(image);
            } else {
                // Kung walay image, himo lang og updated product object
                const updatedProduct = {
                    name: productName,
                    brand: brand,
                    price: price,
                    weight: weight,
                    quantity: quantity,
                    store: store,
                    image: '', // Walay image
                    category: category
                };
                
                // Pagkuha sa existing products gikan sa local storage
                let products = JSON.parse(localStorage.getItem('products')) || [];
                products[index] = updatedProduct; // Pag-update sa product sa specified nga index
                localStorage.setItem('products', JSON.stringify(products));
                showNotification('Product updated successfully!');
                window.location.href = 'settings.html'; // Redirect sa settings page
            }
        }

        // Function para pagpakita sa notification
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.remove('hidden');
            
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 3000);
        }
    </script>
</body>
</html>
